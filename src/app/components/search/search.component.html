<div class="modal-overlay" (click)="onOverlayClick()">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Search dialog" (click)="$event.stopPropagation()">
    <button class="modal-exit" (click)="closeModal()" aria-label="Close search">✕</button>

    <!-- Search View -->
    <div class="search-view">
      <header class="modal-header">
        <div class="modal-title">
          <h2>Find a university</h2>
          <p class="modal-sub">Enter your university name or city</p>
        </div>
      </header>

      <div class="modal-body">
        <label for="university-search" class="sr-only">Enter your university</label>
        <div class="search-field">
          <svg class="field-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
          <input #searchInput id="university-search" type="text" placeholder="Enter your university" class="search-input" [(ngModel)]="query" (input)="onInputChange()"/>
          <button *ngIf="query" class="clear-btn" (click)="query=''; searchInput.focus();" aria-label="Clear">✕</button>
          <button class="search-submit" (click)="submit()" aria-label="Submit search">Search</button>
        </div>
      </div>

      <ul class="results-list" *ngIf="filteredUniversities.length">
        <li *ngFor="let u of filteredUniversities" class="result-item" (click)="selectUniversity(u)" tabindex="0">
          <img 
            [src]="getUniversityLogo(u)" 
            [alt]="u.name + ' logo'" 
            class="university-logo"
            (error)="handleImageError($event)"
          />
          <div class="result-main">
            <div class="result-name">
              <span>{{ u.name }}</span>
              <button class="compare-icon-btn" (click)="addToCompare(u, $event)" title="Add to Compare">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </button>
            </div>
            <div class="result-meta">{{ u.city }} • {{ u.type }}</div>
          </div>
          <a class="result-link" href="{{ u.website }}" target="_blank" rel="noopener noreferrer" (click)="$event.stopPropagation()">website</a>
        </li>
      </ul>
    </div>
  </div>
</div>
